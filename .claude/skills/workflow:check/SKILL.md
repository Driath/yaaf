---
name: workflow:check
description: Validate a workflow structure, sub-skills existence and validation status
---

# workflow:check

Validate a workflow's structure using `skill:check` base validation, verify all referenced sub-skills exist, and check their validation status via `ia/state/skills.md`.

## Usage

```bash
/workflow:check {workflow-name}
/workflow:check --all
```

**Arguments:**
- `{workflow-name}` - Name of the workflow to validate (e.g., `workflow:pr`)
- `--all` - Validate all workflows and generate state file

## Instructions

### 1. Run skill:check

Execute `/skill:check {workflow-name}` for base validation (12 points).

This validates:
- Structure (SKILL.md exists, valid YAML, required fields, name match, body)
- Content (Usage section, Instructions section, <500 lines)
- Output format (has Output section, refs skill:format:out, shows sections)

### 2. Detect Sub-skills

Scan the workflow SKILL.md for sub-skill references using these patterns:

**Pattern 1: Execute commands**
```
Execute /skill-name
Execute `/skill-name`
Execute `/skill-name arg1`
```

**Pattern 2: Sub-skills Used table**
```markdown
## Sub-skills Used

| Skill | Purpose |
|-------|---------|
| `git:pr:find` | Find existing PR |
| `git:pr:create` | Create new PR |
```

Extract all skill names from both patterns.

### 3. Validate Sub-skills Exist

For each detected sub-skill:

```bash
# Check skill directory exists
ls .claude/skills/{sub-skill}/SKILL.md
```

- If exists → ✅ Sub-skill found
- If missing → ❌ WE001: Sub-skill not found

### 3b. Validate Sub-skills (Deep Validation)

Execute `/skill:check {sub-skill}` for each detected sub-skill to get live validation results:

1. For each detected sub-skill:
   - Run `/skill:check {sub-skill}`
   - Capture score and status from output
   - Record: score, status (✅/⚠️/❌), and any corrections needed

2. Aggregate results:
   - If score 100% → ✅ Sub-skill valid
   - If score 50-99% → ⚠️ WE002: Sub-skill has warnings
   - If score <50% → ❌ WE003: Sub-skill is critical

**Scoring impact:**
- All sub-skills ✅ → +0 (no penalty)
- Any sub-skill ⚠️ → Warning in output
- Any sub-skill ❌ → Workflow marked ❌ Critical

**Note:** This is live validation, not cached. Results may differ from `ia/state/skills.md`.

### 4. Handle --all Flag

If `--all` is specified:

```
1. List all workflows: ls .claude/skills/workflow:*/SKILL.md
2. For each workflow, run validation (steps 1-3)
3. Aggregate results
4. Generate ia/state/workflows.md (step 5)
5. Output summary
```

### 5. Generate State File (--all only)

Create/update `ia/state/workflows.md`:

```markdown
# Workflows State

> Auto-generated by `/workflow:check --all`
> Last updated: {timestamp}

| Workflow | Base Score | Sub-skills Exist | Sub-skills Valid | Status |
|----------|------------|------------------|------------------|--------|
| workflow:pr | 8/12 (67%) | 3/3 ✅ | 0/3 ✅ | ⚠️ |
| workflow:end | 10/12 (83%) | 1/1 ✅ | 1/1 ✅ | ⚠️ |

## Sub-skills Deep Validation

| Workflow | Sub-skill | Score | Status |
|----------|-----------|-------|--------|
| workflow:pr | git:pr:find | 8/12 (67%) | ⚠️ |
| workflow:pr | git:pr:create | 8/12 (67%) | ⚠️ |
| workflow:pr | git:pr:monitor | 8/12 (67%) | ⚠️ |
| workflow:end | skill:format:out | 11/12 (92%) | ⚠️ |

## Status Thresholds

| Status | Condition |
|--------|-----------|
| ✅ OK | Base score 100% AND all sub-skills exist AND all sub-skills ✅ |
| ⚠️ Warning | Base score 50-99% OR any sub-skill missing/⚠️ |
| ❌ Critical | Base score <50% OR any sub-skill ❌ |
```

### 6. Output Results

Follow `/skill:format:out`:

```
---
✅ workflow:check completed

## Actions
- Ran skill:check: {score}/12
- Detected sub-skills: {list}
- Validated sub-skills exist: {passed}/{total}
- Validated sub-skills: {ok}/{total} (deep validation via skill:check)

## Result

| Check | Status |
|-------|--------|
| Base Validation | {score}/12 ({percent}%) |
| Sub-skills Exist | {passed}/{total} |
| Sub-skills Valid | {ok}/{total} (deep validation) |

## Corrections
- {fixes needed, or (none)}

## Notes
- {observations}
---
```

For `--all`:

```
---
✅ workflow:check --all completed

## Actions
- Validated {n} workflows
- Generated ia/state/workflows.md

## Result

| Workflow | Base | Sub-skills | Status |
|----------|------|------------|--------|
| workflow:pr | 8/12 | 3/3 ✅ | ⚠️ |
| workflow:end | 10/12 | 1/1 ✅ | ⚠️ |

## Corrections
- {aggregated fixes}

## Notes
- {observations}
---
```

## Error Codes

| Code | Issue |
|------|-------|
| WE001 | Sub-skill not found: `{skill-name}` |
| WE002 | Sub-skill has warnings: `{skill-name}` ({score}%) |
| WE003 | Sub-skill is critical: `{skill-name}` ({score}%) |

Inherits all error codes from `skill:check` (E001-E009, W001-W013).

## Examples

**Single workflow:**
```bash
/workflow:check workflow:pr
```

Output:
```
---
✅ workflow:check completed

## Actions
- Ran skill:check: 8/12
- Detected sub-skills: git:pr:find, git:pr:create, git:pr:monitor
- Validated sub-skills exist: 3/3
- Validated sub-skills: 0/3 ✅ (deep validation via skill:check)

## Result

| Check | Status |
|-------|--------|
| Base Validation | 8/12 (67%) |
| Sub-skills Exist | 3/3 ✅ |
| Sub-skills Valid | 0/3 (deep validation) |

### Sub-skills Validation Details

| Sub-skill | Score | Status |
|-----------|-------|--------|
| git:pr:find | 8/12 (67%) | ⚠️ |
| git:pr:create | 8/12 (67%) | ⚠️ |
| git:pr:monitor | 8/12 (67%) | ⚠️ |

## Corrections
- WE002: git:pr:find (67%) - has warnings
- WE002: git:pr:create (67%) - has warnings
- WE002: git:pr:monitor (67%) - has warnings

## Notes
- Missing E2E test documentation for 100% base score
- Sub-skills need Output sections for full validation
---
```

**All workflows:**
```bash
/workflow:check --all
```

## Output

Follow `/skill:format:out`:

```
---
✅ workflow:check completed

## Actions
- Ran skill:check: {score}/12
- Detected sub-skills: {list}
- Validated sub-skills exist: {passed}/{total}

## Result
Score: {base-score}/12 | Sub-skills: {passed}/{total} | Status: ✅/⚠️/❌

## Corrections
- {fixes needed}

## Notes
- {observations}
---
```
